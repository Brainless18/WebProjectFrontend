{"remainingRequest":"D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\babel-loader\\lib\\index.js!D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!D:\\Programming\\Web\\WebProject\\model-project\\src\\components\\ShareScreen.vue?vue&type=template&id=0a51ecaa&scoped=true","dependencies":[{"path":"D:\\Programming\\Web\\WebProject\\model-project\\src\\components\\ShareScreen.vue","mtime":1626613127830},{"path":"D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621594884307},{"path":"D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1616796459000},{"path":"D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1621594884307},{"path":"D:\\Programming\\Web\\WebProject\\model-project\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1616796459000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCBGcmFnbWVudCBhcyBfRnJhZ21lbnQsIG9wZW5CbG9jayBhcyBfb3BlbkJsb2NrLCBjcmVhdGVCbG9jayBhcyBfY3JlYXRlQmxvY2ssIHdpdGhTY29wZUlkIGFzIF93aXRoU2NvcGVJZCwgcHVzaFNjb3BlSWQgYXMgX3B1c2hTY29wZUlkLCBwb3BTY29wZUlkIGFzIF9wb3BTY29wZUlkIH0gZnJvbSAidnVlIjsKCnZhciBfd2l0aElkID0gLyojX19QVVJFX18qL193aXRoU2NvcGVJZCgiZGF0YS12LTBhNTFlY2FhIik7CgpfcHVzaFNjb3BlSWQoImRhdGEtdi0wYTUxZWNhYSIpOwoKdmFyIF9ob2lzdGVkXzEgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZVZOb2RlKCJ2aWRlbyIsIHsKICBpZDogInJlbW90ZS12aWV3IiwKICBhdXRvcGxheTogIiIKfSwgbnVsbCwgLTEKLyogSE9JU1RFRCAqLwopOwoKdmFyIF9ob2lzdGVkXzIgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZVZOb2RlKCJ2aWRlbyIsIHsKICBpZDogInNlbGYtdmlldyIsCiAgYXV0b3BsYXk6ICIiCn0sIG51bGwsIC0xCi8qIEhPSVNURUQgKi8KKTsKCl9wb3BTY29wZUlkKCk7CgpleHBvcnQgdmFyIHJlbmRlciA9IC8qI19fUFVSRV9fKi9fd2l0aElkKGZ1bmN0aW9uIChfY3R4LCBfY2FjaGUsICRwcm9wcywgJHNldHVwLCAkZGF0YSwgJG9wdGlvbnMpIHsKICByZXR1cm4gX29wZW5CbG9jaygpLCBfY3JlYXRlQmxvY2soX0ZyYWdtZW50LCBudWxsLCBbX2hvaXN0ZWRfMSwgX2hvaXN0ZWRfMl0sIDY0CiAgLyogU1RBQkxFX0ZSQUdNRU5UICovCiAgKTsKfSk7"},{"version":3,"sources":["D:\\Programming\\Web\\WebProject\\model-project\\src\\components\\ShareScreen.vue"],"names":[],"mappings":";;;;;;8BACI,YAAA,CAAyC,OAAzC,EAAyC;AAAlC,EAAA,EAAE,EAAC,aAA+B;AAAjB,EAAA,QAAQ,EAAR;AAAiB,CAAzC,E,IAAA,E;;AAAA,C;;8BACA,YAAA,CAAuC,OAAvC,EAAuC;AAAhC,EAAA,EAAE,EAAC,WAA6B;AAAjB,EAAA,QAAQ,EAAR;AAAiB,CAAvC,E,IAAA,E;;AAAA,C;;;;;sDADA,U,EACA,U","sourcesContent":["<template>\r\n    <video id=\"remote-view\" autoplay></video>\r\n    <video id=\"self-view\" autoplay></video>\r\n    \r\n</template>\r\n\r\n\r\n<script>\r\n\r\nvar webSocket\r\nvar mapPeers = {}\r\nvar localStream = new MediaStream()\r\nvar username\r\nfunction sendSignal(action, message){\r\n  var jsonStr = JSON.stringify({\r\n      'peer': username,\r\n      'action': action,\r\n      'message': message\r\n    })\r\n  webSocket.send(jsonStr)\r\n}\r\nexport default {\r\n    setup() {\r\n        \r\n    },\r\n    data(){\r\n        return({\r\n            wsBackendUrl: 'localhost:8000',\r\n            wsStart: 'ws://',\r\n            isPresenting: null\r\n        })\r\n    },\r\n    methods:{\r\n        \r\n        async initializeStream(){\r\n            const localVideo = document.getElementById(\"self-view\")\r\n            var endPoint = this.wsStart + this.wsBackendUrl\r\n            webSocket = new WebSocket(endPoint)\r\n            webSocket.onopen =  function(e){\r\n                console.log(\"Connection Opened\");\r\n                sendSignal('new-peer', {})\r\n            }\r\n            webSocket.onclose = function(e){\r\n                console.log(\"Connection Closed\");\r\n            }\r\n            webSocket.onerror = function(e){\r\n                console.error(\"Error Occurred\");\r\n            }\r\n            webSocket.onmessage = this.webSocketOnMessage\r\n            if(this.role === \"host\" || this.role === \"presenter\"){\r\n              document.getElementById(\"remote-view\").style.display = \"none\"\r\n              console.log(this.$props.mode);\r\n              if(this.$props.mode === \"screen\"){\r\n                var userMedia = await window.navigator.mediaDevices.getDisplayMedia({\r\n                  video: true,\r\n                  audio: true\r\n                }).then(stream => {\r\n                    localStream = stream\r\n                    localVideo.srcObject = localStream\r\n                    localVideo.muted = true\r\n                }).catch(error => {\r\n                    console.error(error);\r\n                })\r\n              }\r\n              else if(this.$props.mode === \"microphone\"){\r\n                var userMedia = await window.navigator.mediaDevices.getUserMedia({\r\n                  audio: true\r\n                }).then(stream => {\r\n                    localStream = stream\r\n                    localVideo.srcObject = localStream\r\n                    localVideo.muted = true\r\n                }).catch(error => {\r\n                    console.error(error);\r\n                })\r\n                console.log(\"here\");\r\n              }\r\n              \r\n            }\r\n            else{\r\n              localVideo.style.display = \"none\";\r\n            }\r\n            \r\n        },\r\n        webSocketOnMessage(event){\r\n          var parsedData = JSON.parse(event.data)\r\n          var peerUsername = parsedData['peer']\r\n          var peerAction = parsedData['action']\r\n          if(peerUsername == this.username){\r\n            return\r\n          }\r\n          var receiver_channel_name = parsedData['message']['receiver_channel_name']\r\n          if(peerAction == 'new-peer'){\r\n            this.createOfferer(peerUsername, receiver_channel_name)\r\n            return \r\n          }\r\n          if(peerAction == 'new-offer'){\r\n            var offer = parsedData['message']['sdp']\r\n            this.createAnswerer(offer, peerUsername, receiver_channel_name)\r\n            return \r\n          }\r\n          if(peerAction == 'new-answer'){\r\n            var answer = parsedData['message']['sdp']\r\n            var peer = mapPeers[peerUsername][0]\r\n            peer.setRemoteDescription(answer)\r\n            return\r\n          }\r\n        },\r\n        \r\n        createOfferer(username, channel_room){\r\n          var peer = new RTCPeerConnection(null)\r\n          this.addLocalTrack(peer)\r\n          var dataChannel = peer.createDataChannel('channel')\r\n          dataChannel.addEventListener('open', () => {\r\n            console.log(\"Connection Opened\");\r\n          })\r\n          dataChannel.onmessage = this.dataChannelOnMessage\r\n          var remoteVideo = document.getElementById(\"remote-view\")\r\n          this.setOnTrack(peer, remoteVideo)\r\n          mapPeers[username] = [peer, dataChannel]\r\n          peer.oniceconnectionstatechange = function(){\r\n            document.getElementById(\"self\")\r\n            var iceConnectionState = peer.iceConnectionState\r\n            if(iceConnectionState === 'failed' || iceConnectionState === 'disconnected' || iceConnectionState === 'closed'){\r\n              delete mapPeers[username]\r\n              if(iceConnectionState !== 'closed'){\r\n                peer.close()\r\n              }\r\n              this.removeVideo(remoteVideo)\r\n            }\r\n          }\r\n          peer.onicecandidate = function(event){\r\n            if(event.candidate){\r\n              console.log(JSON.stringify(peer.localDescription));\r\n              return \r\n            }\r\n            sendSignal('new-offer', {\r\n              'sdp': peer.localDescription,\r\n              'receiver_channel_name': channel_room\r\n            })\r\n          },\r\n          \r\n          peer.createOffer().then(\r\n            o => peer.setLocalDescription(o).then(\r\n              () =>{\r\n                console.log(\"local description set successfully\"); \r\n              }\r\n            )\r\n          )\r\n        },\r\n        createAnswerer(offer, peerUsername, receiver_channel_name){\r\n          var peer = new RTCPeerConnection(null)\r\n          this.addLocalTrack(peer)\r\n          \r\n          var remoteVideo = document.getElementById(\"remote-view\")\r\n          this.setOnTrack(peer, remoteVideo)\r\n\r\n          peer.ondatachannel = function(e){\r\n            peer.dc = e.channel\r\n            peer.dc.addEventListener('open', () => {\r\n              console.log(\"Connection Opened\");\r\n            })\r\n            peer.dc.onmessage = this.dataChannelOnMessage\r\n            mapPeers[peerUsername] = [peer, peer.dc]\r\n          }\r\n          \r\n          \r\n          peer.oniceconnectionstatechange = function(){\r\n            var iceConnectionState = peer.iceConnectionState\r\n            if(iceConnectionState === 'failed' || iceConnectionState === 'disconnected' || iceConnectionState === 'closed'){\r\n              delete mapPeers[peerUsername]\r\n              if(iceConnectionState !== 'closed'){\r\n                peer.close()\r\n              }\r\n              this.removeVideo(remoteVideo)\r\n            }\r\n          }\r\n          peer.onicecandidate = function(event){\r\n            if(event.candidate){\r\n              console.log(JSON.stringify(peer.localDescription));\r\n              return \r\n            }\r\n            sendSignal('new-answer', {\r\n              'sdp': peer.localDescription,\r\n              'receiver_channel_name': receiver_channel_name\r\n            })\r\n          },\r\n          peer.setRemoteDescription(offer).then(\r\n            () => {\r\n              console.log(\"remote desctription set successfully for %s\", peerUsername);\r\n              return peer.createAnswer()\r\n            }\r\n          ).then(\r\n            a => {\r\n              console.log(\"Answer Created\");\r\n              peer.setLocalDescription(a)\r\n            }\r\n          )\r\n        },\r\n        addLocalTrack(peer){\r\n          localStream.getTracks().forEach(element => {\r\n            peer.addTrack(element, localStream)\r\n          })\r\n          return \r\n        },\r\n        dataChannelOnMessage(event){\r\n          var message = event.data\r\n\r\n        },\r\n        setOnTrack(peer, remoteVideo){\r\n          var remoteStream = new MediaStream()\r\n          remoteVideo.srcObject = remoteStream\r\n          peer.ontrack = function(event){\r\n            remoteStream.addTrack(event.track, remoteStream) \r\n          }\r\n        },\r\n\r\n\r\n    },\r\n    mounted(){\r\n        this.initializeStream()\r\n        username = this.$props.username\r\n        console.log(this.$props.role);\r\n        if(this.$props.role === \"host\" || this.$props.role === \"presenter\"){\r\n          this.isPresenting = true  \r\n        }\r\n        \r\n    },\r\n    props:[\r\n      'username',\r\n      'role',\r\n      'mode'\r\n    ]\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n   \r\n#start {\r\n  position: relative;\r\n  top: 40%;\r\n  width: 100%;\r\n  text-align: center;\r\n}\r\n\r\n#code-input {\r\n  border-radius: 3px;\r\n  margin-bottom: 20px;\r\n  padding: 5px;\r\n  font-size: 16px;\r\n  text-align: center;\r\n  border: none;\r\n}\r\n\r\n#start-button {\r\n  display: block;\r\n  margin: auto;\r\n  padding: 10px;\r\n  font-size: 16px;\r\n  border-radius: 3px;\r\n  font-weight: bold;\r\n  color: white;\r\n  border: none;\r\n}\r\n\r\n#start-button:not(:disabled) {\r\n  cursor: pointer;\r\n  background-color: #000f1c;\r\n}\r\n\r\n#start-button:disabled {\r\n  cursor: not-allowed ;\r\n  background-color: #7691a8;\r\n}\r\n\r\nvideo {\r\n  width: 100%;\r\n}\r\n\r\n#chat-room {\r\n  display: grid;\r\n  grid-gap: 16px;\r\n  width: 100%;\r\n  grid-template-columns: 1fr 3fr;\r\n}\r\n\r\n#remote-view-container{\r\n  position: relative;\r\n  grid-column: 2;\r\n  background-color: black;\r\n  height: 95vh;\r\n}\r\n\r\n#self-view {\r\n  grid-column: 1;\r\n  background-color: black;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n#remote-view {\r\n  \r\n  grid-column: 1;\r\n  background-color: black;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n#view-buttons {\r\n  opacity: 0;\r\n  transition: opacity 0.5s ease-out;\r\n  position: absolute;\r\n  border-radius: 3px;\r\n  background-color: darkgray;\r\n  bottom: 10px;\r\n  padding: 10px;\r\n  left: 0;\r\n  right: 0;\r\n  margin: 20px;\r\n  text-align: center;\r\n}\r\n\r\n#view-buttons:hover {\r\n  opacity: 0.7;\r\n}\r\n\r\n.view-button {\r\n  background-color: darkgray;\r\n  border-color: darkgray;\r\n  border-radius: 3px;\r\n  font-size: 20px;\r\n  color: white;\r\n  padding: 5px;\r\n  border: none;\r\n}\r\n\r\n.view-button:hover {\r\n  cursor: pointer;\r\n  background-color: #757272;\r\n}\r\n</style>"],"sourceRoot":""}]}